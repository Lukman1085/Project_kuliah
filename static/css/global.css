body { margin: 0; padding: 0; }
#map { position: absolute; top: 0; bottom: 0; width: 100%; z-index: 1;}

@import url('https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;700;800&display=swap');

/* [BARU] Indikator Status Mode Gempa */
#mode-status-indicator {
    position: fixed;
    top: 15px; /* Posisi sedikit di bawah searchbar (jika searchbar di atas) */
    left: 50%;
    transform: translateX(-50%);
    z-index: 2000; /* Di atas elemen lain */
    
    background-color: #d32f2f; /* Merah bahaya */
    color: white;
    font-family: 'Manrope', sans-serif;
    font-weight: 800;
    font-size: 0.9rem;
    letter-spacing: 1px;
    padding: 8px 16px;
    border-radius: 50px;
    box-shadow: 0 4px 15px rgba(211, 47, 47, 0.4);
    
    display: none; /* Default hidden */
    align-items: center;
    gap: 8px;
    white-space: nowrap;
    
    animation: status-slide-down 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
}

@keyframes status-slide-down {
    from { top: -50px; opacity: 0; }
    to { top: 15px; opacity: 1; }
}

#koordinat-info {
    position: fixed; 
    bottom: 35px; 
    left: 10px;
    background-color: rgba(255, 255, 255, 0.9);
    padding: 5px 10px; border-radius: 6px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    font-family: 'Manrope', sans-serif; font-size: 11px; font-weight: 600; color: #555; z-index: 1;
}

@media screen and (max-width: 900px) {

    #koordinat-info {
        top: 70px; 
        right: 10px;
        bottom: auto;
        left: auto;
    }

}

#global-loading-spinner {
    position: fixed; 
    top: 10px;
    right: 10px;
    z-index: 2000;  
    background-color: rgba(40, 40, 40, 0.85);
    color: white;
    padding: 8px 12px;
    border-radius: 5px;
    font-family: sans-serif;
    font-size: 13px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    display: none; 
}

.cluster-popup-content { max-height: 200px; overflow-y: auto; }
.cluster-item { padding: 4px; cursor: pointer; }
.cluster-item:hover { background-color: #f0f0f0; }

.map-precip-text { font-family: sans-serif; font-size: 10px; font-weight: bold; line-height: 1; }
.map-weather-icon { font-size: 14px; line-height: 1; }

/* --- STYLING POPUP MAPLIBRE (Z-Index Level 3) --- */
.maplibregl-popup { z-index: 20000 !important; }

.maplibregl-popup-content {
    padding: 0 !important; 
    border-radius: 16px !important; /* Lebih bulat modern */
    box-shadow: 0 10px 30px rgba(0,0,0,0.2), 0 2px 8px rgba(0,0,0,0.1) !important;
    overflow: hidden;
    font-family: 'Manrope', 'Segoe UI', sans-serif; /* Font modern */
}

/* Fix sudut popup arrow */
.maplibregl-popup-anchor-top-left .maplibregl-popup-content { border-top-left-radius: 0 !important; }
.maplibregl-popup-anchor-top-right .maplibregl-popup-content { border-top-right-radius: 0 !important; }
.maplibregl-popup-anchor-bottom-left .maplibregl-popup-content { border-bottom-left-radius: 0 !important; }
.maplibregl-popup-anchor-bottom-right .maplibregl-popup-content { border-bottom-right-radius: 0 !important; }

.maplibregl-popup-close-button {
    color: #555; font-size: 20px; top: 8px; right: 8px; z-index: 10;
    background: rgba(255,255,255,0.7); border-radius: 50%; width: 28px; height: 28px;
    display: flex; align-items: center; justify-content: center; border: none;
    transition: background 0.2s;
    cursor: pointer;
}
.maplibregl-popup-close-button:hover { background: rgba(255,255,255,1); color: #000; }

/* === GENERAL WEATHER POPUP === */
.weather-popup-card { width: 260px; background-color: #fff; color: #333; display: flex; flex-direction: column; }
.popup-header { background-color: #f8f9fa; padding: 12px 15px 8px 15px; border-bottom: 1px solid #eee; }
.popup-title { font-size: 1.1rem; font-weight: 700; color: #2c3e50; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; margin-right: 15px; }
.popup-time { font-size: 0.75rem; color: #7f8c8d; margin-top: 2px; font-weight: 500; }
.popup-main-row { display: flex; align-items: center; padding: 15px; background: linear-gradient(135deg, #0056b3 0%, #004494 100%); color: white; }
.popup-icon-container { flex: 0 0 60px; text-align: center; }
.popup-icon-container i { font-size: 2.5rem; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2)); }
.popup-temp-container { flex-grow: 1; padding-left: 10px; }
.popup-temp { font-size: 2.2rem; font-weight: 700; line-height: 1; text-shadow: 0 2px 4px rgba(0,0,0,0.1); }
.popup-desc { font-size: 0.9rem; font-weight: 500; opacity: 0.9; margin-top: 4px; text-transform: capitalize; }
.popup-details-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; padding: 10px 15px; background-color: #fff; }
.popup-detail-item { font-size: 0.8rem; color: #555; display: flex; align-items: center; }
.popup-detail-item i { width: 20px; text-align: center; color: #0056b3; margin-right: 6px; font-size: 1rem; }
.popup-footer { padding: 10px 15px; border-top: 1px solid #eee; background-color: #f8f9fa; }
.popup-btn-detail { width: 100%; padding: 8px 0; background-color: #e9ecef; color: #2c3e50; border: none; border-radius: 6px; font-weight: 600; font-size: 0.9rem; cursor: pointer; transition: background 0.2s; }
.popup-btn-detail:hover { background-color: #dfe4ea; color: #0056b3; }
.weather-popup-card.province-mode .popup-subtitle { font-size: 0.7rem; font-weight: 700; color: #0056b3; letter-spacing: 1px; margin-bottom: 4px; }
.weather-popup-card.province-mode .popup-title.large { font-size: 1.3rem; margin-top: 0; }
.weather-popup-card.province-mode .popup-body-text { padding: 20px 15px; text-align: center; font-size: 0.9rem; color: #7f8c8d; background-color: #fff; font-style: italic; }

/* ==========================================================================
    [REVISI JILID 2] DESAIN POPUP GEMPA: HEADER SOLID & SUMBER JELAS
    ========================================================================== */
.gempa-popup-card {
    width: 280px; 
    font-family: 'Manrope', sans-serif;
    color: #333;
    background: #fff;
    /* Radius dipindahkan ke container utama popup di map style, 
       tapi kita pastikan card ini mengisi penuh */
    display: flex;
    flex-direction: column;
}

/* 1. HEADER BAR SOLID (Menggantikan Strip Tipis) */
.gempa-header-bar {
    padding: 10px 15px;
    color: white;
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 0.8rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    line-height: 1;
}

/* 2. HERO SECTION (Centered Magnitude) */
.gempa-hero-section {
    padding: 15px 20px 10px 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    background: linear-gradient(to bottom, #fff, #fafafa);
    border-bottom: 1px solid #f0f0f0;
}

.gempa-mag-value-wrapper {
    display: flex;
    align-items: baseline;
    gap: 4px;
    margin-bottom: 4px;
}

.gempa-mag-value {
    font-size: 3.2rem; /* Diperbesar lagi */
    font-weight: 800;
    line-height: 1;
    color: #333;
    letter-spacing: -1px;
}

.gempa-mag-unit {
    font-size: 1.2rem;
    font-weight: 600;
    color: #999;
}

/* 3. META INFO GRID (Rapi) */
.gempa-info-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    border-bottom: 1px solid #f0f0f0;
}

.gempa-info-cell {
    padding: 10px 15px;
    display: flex;
    flex-direction: column;
    align-items: center; /* Center align items */
    text-align: center;
    border-right: 1px solid #f0f0f0;
}
.gempa-info-cell:last-child { border-right: none; }

.gempa-cell-label {
    font-size: 0.65rem;
    color: #999;
    font-weight: 700;
    text-transform: uppercase;
    margin-bottom: 2px;
}

.gempa-cell-value {
    font-size: 0.9rem;
    color: #333;
    font-weight: 600;
}

/* 4. LOKASI */
.gempa-location-section {
    padding: 12px 15px;
    display: flex;
    align-items: flex-start;
    gap: 10px;
    background-color: #fff;
}
.gempa-location-text {
    font-size: 0.85rem;
    color: #444;
    font-weight: 600;
    line-height: 1.4;
}

/* 5. FOOTER AREA (Sumber & Tombol) */
.gempa-footer-section {
    padding: 12px 15px;
    background-color: #f8f9fa;
    border-top: 1px solid #eee;
    display: flex;
    flex-direction: column;
    gap: 8px;
}

/* Teks Sumber (Lebih Tebal & Jelas) */
.gempa-source-text {
    font-size: 0.75rem;
    color: #666;
    text-align: center;
}
.gempa-source-provider {
    font-weight: 800; /* Extra Bold */
    color: #333;      /* Lebih gelap */
    background: #e0e0e0;
    padding: 2px 6px;
    border-radius: 4px;
    font-size: 0.7rem;
    display: inline-block;
}

/* Tombol Detail */
.popup-btn-detail {
    width: 100%; 
    padding: 10px 0; 
    background-color: #fff; 
    border: 1px solid #ddd;
    color: #333; 
    border-radius: 8px; 
    font-weight: 700; 
    font-size: 0.9rem; 
    cursor: pointer; 
    transition: all 0.2s;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}
.popup-btn-detail:hover { 
    background-color: #333; 
    color: #fff;
    border-color: #333;
}

/* --- TEMA WARNA (Untuk Header Bar & Teks Magnitudo) --- */

/* Merah */
.gempa-theme-red .gempa-header-bar { background-color: #d32f2f; }
.gempa-theme-red .gempa-mag-value { color: #d32f2f; }

/* Kuning (Kontras Tinggi) */
.gempa-theme-yellow .gempa-header-bar { 
    background-color: #fbc02d; 
    color: #333; /* Teks hitam di header kuning */
}
.gempa-theme-yellow .gempa-mag-value { color: #f9a825; } 

/* Biru */
.gempa-theme-blue .gempa-header-bar { background-color: #1976d2; }
.gempa-theme-blue .gempa-mag-value { color: #1565c0; }


/* --- MARKER STYLING --- */
.marker-container {
    display: flex; flex-direction: column; align-items: center;
    cursor: pointer; 
    z-index: 10;
    will-change: transform; 
}
.marker-container:hover { z-index: 9999; }
.marker-container:hover .marker-capsule,
.marker-container:hover .location-badge { transform: translateY(-5px); }
.marker-container:hover .marker-capsule { box-shadow: 0 12px 24px rgba(0,0,0,0.2), 0 4px 8px rgba(0,0,0,0.1); }
.marker-dimmed {
    opacity: 0.25 !important; 
    pointer-events: none !important; 
    filter: grayscale(100%); 
    transition: opacity 0.4s ease, filter 0.4s ease !important;
}
.marker-dimmed .marker-capsule, .marker-dimmed .location-badge { transform: scale(0.85); transition: transform 0.4s ease; }
.location-badge {
    background: rgba(26, 26, 26, 0.9); backdrop-filter: blur(4px); color: #fff;
    padding: 4px 10px; border-radius: 6px; font-size: 11px; font-weight: 700; letter-spacing: 0.3px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.15); margin-bottom: 6px; position: relative;
    white-space: nowrap; max-width: 140px; overflow: hidden; text-overflow: ellipsis; text-align: center; pointer-events: none;
    transition: transform 0.2s ease;
}
.location-badge::after {
    content: ''; position: absolute; bottom: -4px; left: 50%; transform: translateX(-50%);
    border-width: 4px 4px 0; border-style: solid; border-color: rgba(26, 26, 26, 0.9) transparent transparent transparent;
}
.province-badge { background: rgba(38, 50, 56, 0.95); } /* Update warna badge provinsi agar serasi */
.province-badge::after { border-color: rgba(38, 50, 56, 0.95) transparent transparent transparent; }

.marker-capsule {
    background: #fff; border-radius: 50px; padding: 4px 8px 4px 4px; display: flex; align-items: center; gap: 8px;
    box-shadow: 0 6px 16px rgba(0,0,0,0.12), 0 2px 4px rgba(0,0,0,0.05);
    position: relative;
    transition: background 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease, transform 0.2s ease; 
}
.main-icon-wrapper, .thermo-liquid, .rain-icon-box i, .cluster-count-circle { transition: background 0.3s ease, color 0.3s ease, transform 0.3s ease; }
.main-icon-wrapper {
    width: 36px; height: 36px; border-radius: 50%; display: flex; justify-content: center; align-items: center;
    font-size: 18px; color: #fff; box-shadow: inset 0 0 0 1px rgba(255,255,255,0.2);
}
.main-icon-wrapper i { filter: drop-shadow(0 2px 2px rgba(0,0,0,0.1)); }

/* [PERBAIKAN] Tata Letak Horizontal untuk Ikon Cuaca */
.status-stack { 
    display: flex; 
    flex-direction: row; /* Horizontal */
    justify-content: center; 
    align-items: center; 
    gap: 8px; /* Jarak antar ikon diperbesar sedikit untuk kerapihan */
    padding-right: 4px; /* Padding dikurangi untuk menyeimbangkan padding kiri di .marker-capsule */
}

.status-stack-province { display: flex; align-items: center; justify-content: center; padding-right: 4px; }

/* ==========================================================================
    [REVISI] Ikon Termometer & Raindrop (Diperbesar dan Disesuaikan)
    ========================================================================== */

/* 1. Ikon Termometer */
.thermo-stack { 
    position: relative; 
    width: 18px; /* Menentukan lebar container untuk menumpuk */
    height: 22px; /* Menentukan tinggi container yang lebih besar */
    display: flex; 
    align-items: center; 
    justify-content: center; 
}

/* Bingkai Luar (Exterior) */
.thermo-frame { 
    font-size: 22px !important; /* Ukuran Frame Diperbesar (Tidak lebih tinggi dari 36px/marker) */
    color: #333; 
    z-index: 2; 
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    line-height: 1; 
}

/* Cairan Internal */
.thermo-liquid { 
    display: block !important; /* Tampilkan kembali */
    font-size: 24px !important; /* DITINGKATKAN: Dari 12px ke 16px agar lebih proporsional */
    color: #dc3545; /* Warna default merah untuk cairan */
    z-index: 3; /* Pastikan di atas frame */
    position: absolute;
    top: 50%;
    left: 50%;
    /* Disesuaikan vertikal agar lebih sentris di dalam bingkai 22px */
    transform: translate(-50%, -50%); 
    line-height: 1; 
}

/* 2. Ikon Hujan */
.rain-icon-box { 
    width: auto; 
    height: auto; 
    display: flex; 
    align-items: center; 
    justify-content: center; 
}
.rain-icon-box i { 
    font-size: 28px; /* Ukuran diperbesar, sebanding dengan tinggi termometer */
    color: #007bff; /* Warna default biru untuk air/hujan */
    line-height: 1; 
    transform: translateY(2px); /* Penyesuaian vertikal agar lebih sentris */
}

/* ==========================================================================
    [AKHIR REVISI]
    ========================================================================== */


.marker-anchor {
    width: 6px; height: 6px; background: #fff; border-radius: 50%; margin-top: 2px; 
    box-shadow: 0 1px 3px rgba(0,0,0,0.3); z-index: -1; position: relative;
}
.marker-pulse {
    position: absolute; bottom: -4px; left: 50%; transform: translateX(-50%);
    width: 20px; height: 20px; background: rgba(0, 123, 255, 0.4); border-radius: 50%;
    z-index: -2; animation: pulse 2s infinite; pointer-events: none;
}
@keyframes pulse { 0% { transform: translateX(-50%) scale(0.5); opacity: 0.8; } 100% { transform: translateX(-50%) scale(2.5); opacity: 0; } }
@keyframes markerPopIn { 0% { transform: scale(0); opacity: 0; } 60% { transform: scale(1.15); opacity: 1; } 100% { transform: scale(1); opacity: 1; } }
.marker-entrance .marker-capsule { animation: markerPopIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1) forwards; }
.marker-theme-sunny .main-icon-wrapper { background: linear-gradient(135deg, #FFC107, #FF9800); }
.marker-theme-cloudy .main-icon-wrapper { background: linear-gradient(135deg, #90A4AE, #546E7A); }
.marker-theme-rain .main-icon-wrapper { background: linear-gradient(135deg, #42A5F5, #1E88E5); }
.marker-theme-storm .main-icon-wrapper { background: linear-gradient(135deg, #546E7A, #263238); }
.marker-theme-night .main-icon-wrapper { background: linear-gradient(135deg, #2c3e50, #34495e); }

/* [PERBAIKAN] Warna Marker Provinsi Dark Slate */
.marker-theme-province .main-icon-wrapper { background: linear-gradient(135deg, #455A64 0%, #263238 100%); }

.marker-skeleton .marker-capsule { background: #f0f0f0; border: 1px solid #e0e0e0; }
.marker-theme-skeleton .main-icon-wrapper { background: #444 !important; }
.marker-theme-skeleton i { color: #fff !important; }
.cluster-count-circle {
    box-shadow: 0 2px 4px rgba(0,0,0,0.15) !important; 
    border: 1px solid rgba(255,255,255,0.2); 
    text-shadow: 0 1px 2px rgba(0,0,0,0.1); 
}
.cluster-gradient-blue { background: linear-gradient(135deg, #4FC3F7 0%, #2196F3 100%); }
.cluster-gradient-yellow { background: linear-gradient(135deg, #FFD54F 0%, #FFB300 100%); }
.cluster-gradient-red { background: linear-gradient(135deg, #E57373 0%, #D32F2F 100%); }
.marker-capsule span { color: #555; font-weight: 700; letter-spacing: 0.5px; }
.marker-loading .marker-capsule { opacity: 0.7; }
.marker-loading .main-icon-wrapper i { animation: spin-loading 1.5s linear infinite; }
@keyframes spin-loading { 100% { transform: rotate(360deg); } }
.cluster-item.skeleton-mode { pointer-events: none; }
.cluster-item.skeleton-mode .cluster-item-loading-block {
    background-color: #f0f0f0; color: transparent !important; border-radius: 4px;
    position: relative; overflow: hidden; display: inline-block;
}
.cluster-item.skeleton-mode .cluster-item-loading-block::after {
    content: ""; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.6), transparent);
    transform: translateX(-100%); animation: skeleton-shimmer 1.5s infinite;
}
.skeleton-icon { width: 24px; height: 24px; border-radius: 50%; }
.skeleton-text-short { width: 60px; height: 12px; margin-bottom: 2px; }
.skeleton-text-long { width: 90px; height: 10px; }

/* ==========================================================================
    [REVISI] LEGENDA: POSISI & ANIMASI KANAN ATAS
    ========================================================================== */
.map-legend-container {
    position: absolute;
    /* Default Desktop: Kanan Atas, di bawah area kontrol map (Zoom dll biasanya 10px dari atas) */
    top: 60px; /* Offset dari atas agar tidak menabrak kontrol standar */
    right: 10px;
    width: 200px; /* Lebih ramping */
    
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(8px);
    border-radius: 12px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    font-family: 'Manrope', sans-serif;
    z-index: 20005; 
    overflow: hidden;
    border: 1px solid rgba(0,0,0,0.05);

    /* --- LOGIKA ANIMASI BARU (Smooth Fade/Slide) --- */
    opacity: 0;
    transform: translateX(30px); /* Geser ke kanan (keluar layar) */
    pointer-events: none; /* Klik tembus saat hidden */
    transition: opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1), 
                transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Class ini ditambahkan JS saat legenda aktif */
.map-legend-container.legend-visible {
    opacity: 1;
    transform: translateX(0); /* Geser ke posisi normal */
    pointer-events: auto;
}

/* --- RESPONSIVITAS MOBILE --- */
@media (max-width: 600px) {
    .map-legend-container {
        /* Di Mobile, Search Bar ada di tengah atas.
           Kita pindahkan Legenda agak ke bawah agar tidak tertutup Search Bar */
        top: 80px; 
        right: 10px; 
    }
}

.legend-header {
    background: #fff;
    padding: 10px 12px;
    border-bottom: 1px solid #f0f0f0;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-weight: 700;
    color: #333;
    font-size: 0.8rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.legend-close-btn {
    background: none; border: none; font-size: 18px; cursor: pointer; color: #ccc; line-height: 1; padding: 0 4px;
}
.legend-close-btn:hover { color: #333; }
.legend-body { padding: 10px; display: flex; flex-direction: column; gap: 10px; }
.legend-item { display: flex; align-items: center; gap: 10px; }
.legend-icon-wrapper { width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; position: relative; }
.legend-label { display: flex; flex-direction: column; line-height: 1.2; }
.legend-label strong { font-size: 0.75rem; color: #444; }
.legend-label span { font-size: 0.65rem; color: #888; }
.legend-dot { width: 10px; height: 10px; border-radius: 50%; border: 2px solid white; box-shadow: 0 1px 3px rgba(0,0,0,0.3); position: relative; }
.legend-dot.red { background-color: #d32f2f; }
.legend-dot.yellow { background-color: #fbc02d; } /* Kuning Emas */
.legend-dot.blue { background-color: #1976d2; }
.pulse-fast::after { content: ''; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 100%; height: 100%; border-radius: 50%; background: inherit; z-index: -1; animation: legend-pulse 1s infinite; }
.pulse-slow::after { content: ''; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 100%; height: 100%; border-radius: 50%; background: inherit; z-index: -1; animation: legend-pulse 2s infinite; }
@keyframes legend-pulse { 0% { transform: translate(-50%, -50%) scale(1); opacity: 0.8; } 100% { transform: translate(-50%, -50%) scale(2.5); opacity: 0; } }
.legend-sonar { width: 8px; height: 8px; background: #d32f2f; border-radius: 50%; position: relative; }
.legend-sonar::before, .legend-sonar::after { content: ''; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); border-radius: 50%; border: 1px solid #d32f2f; animation: legend-sonar-wave 2s infinite; }
.legend-sonar::after { animation-delay: 0.5s; }
@keyframes legend-sonar-wave { 0% { width: 8px; height: 8px; opacity: 1; border-width: 2px; } 100% { width: 24px; height: 24px; opacity: 0; border-width: 0px; } }